# 海关检疫性杂草种子与昆虫检测项目课题二需求分析
## 项目说明
**整体要求：** 5公斤样品中取1公斤进行检测，通过筛分、自动识别等流程，找出大豆和小麦样本中的检疫性昆虫和杂草种子，回答“有没有、在哪里、是什么”这三个问题。

**验收指标：** 在1h内准确率不低于95%

**附加要求：**

1. 全程尽量降低人工参与度
2. 识别要求回答到“种”  （科 属 种）
3. 提供一个置信度阈值，高于该阈值则不需要复检
4. 如果有活虫，可以直接判定为不合格。

**难点说明：**

1. 大豆和小麦、杂草与昆虫的形态、尺度有差异，分筛的要求不同（做筛板可替换）
2. 杂草种子种类繁多、差异大，拍摄清晰图片困难（解决：分筛后用两种相机拍摄，对小物体使用微距拍摄）
3. 要求对近似种准确判别（根据人工识别时的判断特征，将知识融入模型）
4. 灰尘、残肢问题（灰尘问题对应在建立数据集时拍摄带灰尘样品，残肢问题属于有待研究的学术问题，之后再讨论，现阶段不过分纠结该问题）

## 系统工作流程
1. **活虫检测：** 将1kg样品放入盒中，抖动铺开。用固定相机（约2,000w像素）拍摄约30s视频，识别样品中是否有活虫（重点关注成虫，幼虫现阶段不考虑）。**输出：** 如果无活虫，输出“未检测到活虫”，样品送入下一步检测。如果检测到活虫，在拍摄视频中用红框标记正在移动的活虫，作为证据存档；该批样本直接判定为不合格。

2. **分筛：** 将1kg样品送入分筛机器，目前计划是分为三层：
	- 第一层（筛上层），>4.5mm的杂质，内容包含外壳、大颗粒杂草种子、草杆等
	- 第二层，>2.5mm的原粮，内容包含原粮、与原粮类似大小的杂草种子
	- 第三层（筛下层），<2.5mm的杂质，内容包含灰尘、小颗粒杂草种子、昆虫等
3. **拍摄与识别：**
	- 第一层（筛上层），内容物不多，震动摊开后使用2,000w像素相机，拍摄一张图片。即一张图片中包含多个物体，识别算法对图片中物体分割（传统算法）并识别（深度学习模型）。
	- 第二层，1kg约有2w粒原粮，全部铺开面积过大，因此参考福斯的仪器，在传送带上平摊并拍照。同样一张图片中包含多个物体。
	- 第三层，灰尘层，内容物也不多，同样震动摊开，但是使用微距相机，配合小型龙门架拍摄清晰高像素图片。一般一张图片中只包含一个物体，但也可能包含多个。
4. **输出结果：** 在软件中输出识别结果和对应的照片。

## 工作计划
### 设计定位算法
**背景：** 因为要减少人工参与，因此不是人单独把杂草种子或昆虫挑拣出来逐个拍照，而是一次性对分筛后的结果拍照，因此一张图上包含多个不同类别的物体，如果需要识别出图中有哪些物体，需要先将物体图片单独切分出来后识别，也就是需要定位分割算法。

**预计使用的方法：** 使用传统图像处理的算法（避免标注大量位置数据）。首先将输入图片二值化，得到黑白图片，然后使用算法找到每个物体的外包围框（bounding box）。根据该bbox坐标在图片上切割出物体图片，送入后续分类模型。

**难点分析：**
1. 该算法成立的前提假设是，物体之间间隔一定距离。如果两个物体贴在一起或者重叠，则无法分割。**应对策略：** 对于贴在一起的情况，可以使用开闭算法。对于重叠的情况，需要后续思考调研策略。
2. 对于灰尘层，可能背景和物体颜色接近，难以得到二值图。**应对策略：** 用区域自适应计算阈值，如果这个无法解决，再调研别的算法。

**工作计划：** 用菜籽模拟实际情况，手动筛分后拍照。菜籽中有不同形状、不同大小。使用该图片设计和实践分割算法。

## 会议纪要
### 2022年7月13日会议纪要
**地点：** 海关实验室

**会议重点：** 学习海关购买的美国进口粮谷杂质分筛机工作原理、关于识别名单、人工筛选与识别过程、实际情况细节的问题交流讨论。

**交流问题及解答记录**
1. 已提供名单中，包含300种昆虫，50种杂草。这些名单是否能够涵盖海关检疫需求？（是否有补充？）

**解答：**
	- 昆虫名单来源于仓储名单列表，近年以来，昆虫名单没有更新，没有出现爆发式新种。300种相当于是最宽了，足够了。随后将提供新的名单，根据三个指标（检疫性的、国外关注的、常规的）对名单内昆虫分级，第一类必做，第二类争取。**分级后必须识别的昆虫会在50种以内**。
	- 杂草数据来源与近几年截获的名单统计，但目前提供的50种是不够的。杂草种类繁多，还具有地域性，不同国家也不同，北美杂草和南美杂草也不同，还有澳洲，典型的种类要列进去。后续将参考美国农业部谷物手册等资料中关注的杂草种类对名单进行修订。由于种类确实很多，考虑项目新需求，名单中应列入常规种，考虑科属的代表性、地域，**杂草种子名单将控制在80-100种**。

2. 在这300种昆虫，50种杂草中，有多少个科、多少个属？

**解答：** 这个也可以在后续提供的名单中标注。

3. 需要分辨到科/属/种？一般人工怎么分辨这些相似的对象？

**解答：**
	- 要识别到种。希望可以提供一个阈值，如果识别置信度在该阈值以上，则不需要做复查。
	- 需要识别的昆虫和杂草种子中，一般都是人眼就能分辨出来，有些需要放大镜看细节。但是**不同的放大倍速，看到的特征也不一样**。按尺度不同，放大不同的倍数不同，**一般放大到50倍识别**。
	- 识别名单中会包含一些近似种。这些种在人工识别时关注的特征，可以提供简要描述。需要对标注软件优化，除了分类，还需要添加特征描述功能。

4. 同一个物种内，不同个体之间的差异是否大？同一个体之间各个阶段是否有很大差异？（该问题涉及建立数据库图片时，需要拍摄的样本的数量问题。）

**解答：** 根据图册，我们发现杂草种子个体差异大，需要提供更多的样本。海关这边可以每类都提供几个典型的样本。

5. 对于活虫，是否需要处死后识别？（刚刚处死的昆虫附肢是否展开，还是和死了很久的昆虫一样蜷成球？）

**解答：** 使用运动检测判断是否有活虫，如果有活虫，直接将该批次粮谷判定为不合格。只需要判断是否有活的成虫，不考虑幼虫的情况。之后进阶工作可以将活虫处死后判断类别。至于蜷成球的问题，确实用酒精泡一下可以张开附肢，但是需要泡30min才能展开。这种确实难以判断类别的，可以上报人工识别。

6. 在人工分类识别中，从分筛后拿到样品开始，到识别出类别，有哪些过程？

**解答：** 首先人工在白瓷盘中挑出杂草和昆虫，然后用解剖镜观察特征，洗的话是有必要才洗。（很多样本很小，必须放大，约100倍）。洗的话，用的小毛刷（类似画画的毛笔）蘸酒精刷。一次可以将多个样品同时放到显微镜下观察。高度怀疑有检疫性的、特征不明显的（残肢等）需要做分子测序。

7. 实际分筛得到的样本状态并不好，可能携带灰尘、部分缺失。这种情况对识别有什么影响？

**解答：** 如果携带过多灰尘影响判断，就会用酒精清洗。对残肢的情况，先大致判断，如果特诊明显的可以直接识别。有部分残缺的样品（比如少了个头）也可以识别。

8. 昆虫和杂草种子的数据库，有没有网络上的数据库推荐？

**解答：** 之后可以给网站链接（粮谷）。昆虫的只有常见种（也很少），不全面。

9. 一批五公斤样本中，一般有多少数量的昆虫？多少数量的杂草种子？

**解答：** 杂草种子少的可能一个都没有（少见），一般来说有两、三百例，种类大概四五十种。数量最多的时候可以上千例。昆虫是少的话几个，多的话上百。中间情况比较少。

10. 现用的技术，将杂草和昆虫从粮谷中分筛出来的过程中，有哪些具体环节？这些环节中有哪些可以用机器实现，哪些必须人工实现？

**解答：** 人工用筛盘过筛，然后人工摊开、挑选。（也就是全程人工完成，无机器参与）筛盘尺寸：后续提供

11. 对于杂草种子，草籽在草杆里面，需要人工单独摘除来的情况常见吗？

**解答：** 小麦里面没有，大豆里面可能会有。带杆的不是重点，重点是单独的草籽。

12. 之后能否为我们提供一些杂草种子和昆虫的实物样本呢？

**解答：** 可以。样本中包含不同国别（国别针对杂草，对昆虫来说没有地域性的问题）、大小、成熟度。
